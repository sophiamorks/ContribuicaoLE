<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendário da Secretaria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .calendar-day.today {
            background-color: #FFCA2C;
            color: #1A1F51;
            font-weight: bold;
        }
        .event-preview {
            background-color: #4EB969;
            color: white;
            font-size: 0.7rem;
            line-height: 0.9rem;
        }
        .has-events {
            cursor: pointer;
            background-color: #f0f9f3;
        }
        .has-events:hover { background-color: #e0f2e7; }
        #event-modal { transition: opacity 0.3s ease; }
    </style>
</head>

<body class="bg-gray-100">

    <!-- Cabeçalho -->
    <header class="bg-[#1A1F51] shadow-md">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-white">Calendário da Secretaria</h1>
                <p class="text-[#AFD8BD] mt-1">Planejamento e Prazos</p>
            </div>
            <a href="index.html" class="bg-[#FFCA2C] text-[#1A1F51] font-bold py-2 px-4 rounded-lg hover:bg-yellow-400 transition-colors duration-300">
                Voltar à Página Inicial
            </a>
        </div>
    </header>

    <!-- Conteúdo Principal -->
    <main class="container mx-auto px-6 py-8">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <button id="prev-month" class="p-2 rounded-full hover:bg-gray-200 transition-colors" type="button">
                    <svg class="w-6 h-6 text-[#1A1F51]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <h2 id="current-month" class="text-2xl font-bold text-[#1A1F51]"></h2>
                <button id="next-month" class="p-2 rounded-full hover:bg-gray-200 transition-colors" type="button">
                    <svg class="w-6 h-6 text-[#1A1F51]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
            </div>

            <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center">
                <!-- Dias da semana -->
                <div class="font-bold text-gray-600 py-2">Dom</div>
                <div class="font-bold text-gray-600 py-2">Seg</div>
                <div class="font-bold text-gray-600 py-2">Ter</div>
                <div class="font-bold text-gray-600 py-2">Qua</div>
                <div class="font-bold text-gray-600 py-2">Qui</div>
                <div class="font-bold text-gray-600 py-2">Sex</div>
                <div class="font-bold text-gray-600 py-2">Sáb</div>
                <!-- Células do calendário serão inseridas aqui -->
            </div>
        </div>
    </main>

    <!-- Modal de Eventos -->
    <div id="event-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md transform transition-all duration-300 scale-95 opacity-0">
            <div class="p-4 border-b flex justify-between items-center bg-[#1A1F51] text-white rounded-t-lg">
                <h3 id="modal-date" class="text-xl font-bold">Eventos do Dia</h3>
                <button id="modal-close" class="text-2xl font-bold leading-none hover:text-gray-300" type="button">&times;</button>
            </div>
            <div id="modal-body" class="p-6 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <!-- Rodapé -->
    <footer class="bg-[#1A1F51] mt-8">
        <div class="container mx-auto px-6 py-4 text-center text-[#AFD8BD]">
            <p>&copy; 2026 Nexo Governamental XI de Agosto. Todos os Direitos Reservados.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const currentMonthEl = document.getElementById('current-month');
            const calendarGrid = document.getElementById('calendar-grid');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');

            const modal = document.getElementById('event-modal');
            const modalDate = document.getElementById('modal-date');
            const modalBody = document.getElementById('modal-body');
            const modalClose = document.getElementById('modal-close');
            const modalContent = modal.querySelector('.bg-white');

            // ✅ Começa no mês atual (não fixo em setembro/2025)
            let currentDate = new Date();

            /**
             * EVENTOS PONTUAIS (você cadastra por data)
             * Chave: "YYYY-M-D" (igual seu arquivo original)
             * Valor: array de objetos
             */
            const events = {
                // exemplos:
                // '2026-2-10': [{ time: '13:00', title: 'Reunião de alinhamento', type: 'reuniao' }],
                // '2026-2-18': [{ time: '23:59', title: 'Prazo interno: rascunho (Local)', type: 'prazo' }],

                '2025-10-1': [
                    {time: '13:00', title: 'Sessão na Assembleia Legislativa de São Paulo', type: 'parlamentar', esfera: 'ALESP', parlamentar: 'Thiago Auricchio'}
                ],
                '2025-10-3': [{time: 'Todo dia', title: 'COLIPON', type: 'reuniao'}],
                '2025-10-4': [{time: 'Todo dia', title: 'COLIPON', type: 'reuniao'}],
                '2025-10-5': [{time: 'Todo dia', title: 'COLIPON', type: 'reuniao'}]
            };

            /**
             * ✅ EVENTO FIXO SEMANAL (automático)
             * Domingo (0) às 18h
             */
            const weeklyFixedEvents = [
                { weekday: 0, time: '18:00', title: 'Reunião da Secretaria', type: 'reuniao' }
            ];

            function getWeeklyFixedEventsForDate(dateObj) {
                const weekday = dateObj.getDay(); // 0 = domingo
                return weeklyFixedEvents
                    .filter(e => e.weekday === weekday)
                    .map(e => ({...e, fixed: true}));
            }

            function getKeyFromDateParts(year, monthIndex, day) {
                // monthIndex é 0-based; events usa mês 1-based
                return `${year}-${monthIndex + 1}-${day}`;
            }

            function getEventsForDay(year, monthIndex, day) {
                const dateObj = new Date(year, monthIndex, day);
                const key = getKeyFromDateParts(year, monthIndex, day);

                const fixed = getWeeklyFixedEventsForDate(dateObj);
                const puntual = (events[key] || []).map(e => ({...e, fixed: false}));

                // Ordem: fixo primeiro (reunião), depois pontuais
                return [...fixed, ...puntual];
            }

            function renderCalendar() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();

                currentMonthEl.textContent =
                    `${currentDate.toLocaleString('pt-BR', { month: 'long' })} de ${year}`;

                // Limpa o grid mantendo os 7 cabeçalhos dos dias da semana
                while (calendarGrid.children.length > 7) {
                    calendarGrid.removeChild(calendarGrid.lastChild);
                }

                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                // Espaços vazios antes do dia 1
                for (let i = 0; i < firstDayOfMonth; i++) {
                    calendarGrid.appendChild(document.createElement('div'));
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    dayCell.className =
                        'calendar-day p-1 border rounded-md min-h-[100px] flex flex-col items-start transition-colors';

                    const dayNumber = document.createElement('span');
                    dayNumber.className = 'font-semibold p-1';
                    dayNumber.textContent = day;
                    dayCell.appendChild(dayNumber);

                    // Hoje
                    const today = new Date();
                    if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                        dayCell.classList.add('today');
                    }

                    const dayEvents = getEventsForDay(year, month, day);

                    if (dayEvents.length) {
                        dayCell.classList.add('has-events');

                        const eventsPreviewContainer = document.createElement('div');
                        eventsPreviewContainer.className = 'mt-1 w-full text-left overflow-hidden space-y-1';

                        // Preview do primeiro evento (fixo ou pontual)
                        const firstEvent = dayEvents[0];
                        const eventPreview = document.createElement('div');
                        eventPreview.className = 'event-preview p-1 rounded truncate';
                        eventPreview.textContent = `${firstEvent.time} - ${firstEvent.title}`;
                        eventsPreviewContainer.appendChild(eventPreview);

                        // Se tiver mais, mostra +N
                        if (dayEvents.length > 1) {
                            const moreEventsIndicator = document.createElement('div');
                            moreEventsIndicator.className = 'text-xs text-gray-600 px-1';
                            moreEventsIndicator.textContent = `+${dayEvents.length - 1} mais`;
                            eventsPreviewContainer.appendChild(moreEventsIndicator);
                        }

                        dayCell.appendChild(eventsPreviewContainer);

                        dayCell.addEventListener('click', () => {
                            openModal(day, month, year, dayEvents);
                        });
                    }

                    calendarGrid.appendChild(dayCell);
                }
            }

            function openModal(day, month, year, dayEvents) {
                modalDate.textContent =
                    `Eventos de ${day} de ${new Date(year, month, 1).toLocaleString('pt-BR', { month: 'long' })}`;

                modalBody.innerHTML = '';

                const eventList = document.createElement('ul');
                eventList.className = 'space-y-4';

                dayEvents.forEach(event => {
                    const listItem = document.createElement('li');

                    // Fixo = borda azul; pontual = borda verde
                    const borderColor = event.fixed ? 'border-[#1A1F51]' : 'border-[#4EB969]';

                    listItem.className = `p-3 bg-gray-50 rounded-lg border-l-4 ${borderColor}`;

                    let content =
                        `<div class="font-bold text-[#1A1F51]">${event.time} - ${event.title}</div>`;

                    // Tag “fixo semanal” (pra ficar claro)
                    if (event.fixed) {
                        content += `<div class="text-xs text-gray-600 mt-1"><strong>Tipo:</strong> evento fixo semanal</div>`;
                    }

                    if (event.type === 'parlamentar') {
                        content += `<div class="text-sm text-gray-600 mt-1"><strong>Parlamentar:</strong> ${event.parlamentar || '-'}</div>`;
                        content += `<div class="text-sm text-gray-600"><strong>Esfera:</strong> ${event.esfera || '-'}</div>`;
                    }

                    listItem.innerHTML = content;
                    eventList.appendChild(listItem);
                });

                modalBody.appendChild(eventList);

                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                }, 10);
            }

            function closeModal() {
                modalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }

            prevMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            nextMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            modalClose.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });

            renderCalendar();
        });
    </script>
</body>
</html>
